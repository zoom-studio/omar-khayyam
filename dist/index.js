"use strict";const a=a=>({year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),weekDay:a.getDay()}),t=(a,t)=>a-t*Math.floor(a/t);class e{constructor(i,r){switch(this._getCalendarEpoch=a=>{switch(a){case"gregorian":return 1721425.5;case"islamic":return 1948439.5;case"jalali":return 1948320.5}},this._getJulianWeekDay=a=>t(Math.floor(a+1.5),7),this._isLeapYear=(a,t)=>{switch(t){case"gregorian":return a%4==0&&!(a%100==0&&a%400!=0);case"jalali":return 682*((a-(a>0?474:473))%2820+474+38)%2816<682;case"islamic":return(11*a+14)%30<11}},this._toJulianDate=(a,e)=>{const{year:i,month:r,day:o}=a;switch(e){case"jalali":{const a=i-(i>=0?474:473),e=474+t(a,2820);return o+(r<=7?31*(r-1):30*(r-1)+6)+Math.floor((682*e-110)/2816)+365*(e-1)+1029983*Math.floor(a/2820)+(this._getCalendarEpoch("jalali")-1)}case"gregorian":return this._getCalendarEpoch("gregorian")-1+365*(i-1)+Math.floor((i-1)/4)+-Math.floor((i-1)/100)+Math.floor((i-1)/400)+Math.floor((367*r-362)/12+(r<=2?0:this._isLeapYear(i,e)?-1:-2)+o);case"islamic":return o+Math.ceil(29.5*(r-1))+354*(i-1)+Math.floor((3+11*i)/30)+this._getCalendarEpoch("islamic")-1}},this._toGregorian=(a,e)=>{let i;const r=this._toJulianDate(a,e),o=this._getJulianWeekDay(r),s=Math.floor(r-.5)+.5,h=s-this._getCalendarEpoch("gregorian"),l=Math.floor(h/146097),n=t(h,146097),c=Math.floor(n/36524),_=t(n,36524),g=Math.floor(_/1461),y=t(_,1461),u=Math.floor(y/365);i=400*l+100*c+4*g+u,4!==c&&4!==u&&i++;const D={year:i,month:1,day:1,weekDay:0},d=s-this._toJulianDate(D,"gregorian");D.month=3;const m=s<this._toJulianDate(D,"gregorian")?0:this._isLeapYear(i,"gregorian")?1:2,f=Math.floor((12*(d+m)+373)/367);D.month=f;const M=s-this._toJulianDate(D,"gregorian")+1;return D.day=M,D.weekDay=o,D},this._toJalali=(a,e)=>{let i=this._toJulianDate(a,e)+Math.floor(.5)/86400;const r=this._getJulianWeekDay(i);i=Math.floor(i)+.5;const o={year:475,month:1,day:1,weekDay:0},s=i-this._toJulianDate(o,"jalali"),h=Math.floor(s/1029983),l=t(s,1029983);let n=0;if(1029982===l)n=2820;else{const a=Math.floor(l/366),e=t(l,366);n=Math.floor((2134*a+2816*e+2815)/1028522)+a+1}let c=n+2820*h+474;c<=0&&c--,o.year=c;const _=i-this._toJulianDate(o,"jalali")+1,g=_<=186?Math.ceil(_/31):Math.ceil((_-6)/30);o.month=g;const y=i-this._toJulianDate(o,"jalali")+1;return o.day=y,o.weekDay=r,o},this._toIslamic=(a,t)=>{const e=Math.floor(this._toJulianDate(a,t))+.5,i={year:Math.floor((30*(e-this._getCalendarEpoch("islamic"))+10646)/10631),month:1,day:1,weekDay:0};return i.month=Math.min(12,Math.ceil((e-(29+this._toJulianDate(i,"islamic")))/29.5)+1),i.day=e-this._toJulianDate(i,"islamic")+1,i.weekDay=this._getJulianWeekDay(e),i},this.toJalali=()=>new e("jalali",this._toJalali(this._date,this._calendar)),this.toGregorian=()=>new e("gregorian",this._toGregorian(this._date,this._calendar)),this.toIslamic=()=>new e("islamic",this._toIslamic(this._date,this._calendar)),this.toJulianDay=()=>this._toJulianDate(this._date,this._calendar),i=i??"gregorian",r=(t=>{if(t instanceof Date)return a(t);if("number"==typeof t||"string"==typeof t){const e=new Date(t);return a(e)}if("year"in t)return{...t,weekDay:0};const[e,i,r,o]=t.map(Number);return{year:e,month:i,day:r,weekDay:o??0}})(r??new Date),this._calendar=i,this._calendar){case"gregorian":this._date=this._toGregorian({...r,weekDay:0},i);break;case"islamic":this._date=this._toIslamic({...r,weekDay:0},i);break;case"jalali":this._date=this._toJalali({...r,weekDay:0},i)}}get date(){return this._date}get isLeapYear(){return this._isLeapYear(this._date.year,this._calendar)}}exports.KhayyamNS=void 0,(exports.KhayyamNS||(exports.KhayyamNS={})).Calendars=["jalali","islamic","gregorian"],exports.Khayyam=e;
